<ion-header translucent>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>

    <ion-title>Teacher Dashboard</ion-title>

    <ion-buttons slot="end">
      <ion-button color="primary" routerLink="/upload">
        <ion-icon name="add-circle-outline" slot="start"></ion-icon>
        New Course
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- ================= COURSES VIEW ================= -->
  <ng-container *ngIf="!selectedCourseId">

    <ion-text color="medium">
      <h2 class="section-title">My Courses</h2>
    </ion-text>

    <!-- Empty State -->
    <ion-card *ngIf="teacherCourses.length === 0" class="empty-card">
      <ion-card-content class="ion-text-center">
        <ion-icon name="school-outline" size="large"></ion-icon>
        <h3>No courses yet</h3>
        <p>Create your first course to start teaching.</p>
        <ion-button expand="block" color="primary" routerLink="/upload">
          Create Course
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- Courses Grid -->
    <ion-grid *ngIf="teacherCourses.length > 0">
      <ion-row>
        <ion-col
          size="12"
          size-md="6"
          size-lg="4"
          *ngFor="let course of teacherCourses"
        >

          <ion-card class="course-card">

            <img
              *ngIf="course.coverImage"
              [src]="course.coverImage"
              class="course-image"
            />

            <ion-card-header>
              <ion-card-title>{{ course.title }}</ion-card-title>
              <ion-card-subtitle>
                {{ course.category }} â€¢ {{ course.level }}
              </ion-card-subtitle>
            </ion-card-header>

            <ion-card-content>
              <p class="course-description">
                {{ course.description || 'No description provided.' }}
              </p>

              <div class="course-meta">
                <ion-chip color="primary">
                  <ion-icon name="people-outline"></ion-icon>
                  {{ course.totalStudents || 0 }} students
                </ion-chip>

                <ion-chip color="success">
                  <ion-icon name="star-outline"></ion-icon>
                  {{ course.rating || 0 }}
                </ion-chip>
              </div>
            </ion-card-content>

            <ion-footer class="course-actions">
              <ion-button fill="clear" color="primary" [routerLink]="['/course', course.id]">
                View
              </ion-button>

              <ion-button fill="clear" color="medium"
                (click)="viewStudentProgress(course.id!)">
                Progress
              </ion-button>

              <ion-button fill="clear" color="danger"
                (click)="deleteCourse(course.id!)">
                Delete
              </ion-button>
            </ion-footer>

          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>

  </ng-container>

  <!-- ================= PROGRESS VIEW ================= -->
  <ng-container *ngIf="selectedCourseId">

    <ion-button fill="clear" color="medium"
      (click)="selectedCourseId = null; studentProgress = []">
      <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
      Back to Courses
    </ion-button>

    <h2 class="section-title">Student Progress</h2>

    <!-- Stats -->
    <ion-grid class="stats-grid">
      <ion-row>
        <ion-col size="4">
          <ion-card class="stat-card">
            <ion-card-content>
              <h2>{{ getEnrolledCount() }}</h2>
              <p>Enrolled</p>
            </ion-card-content>
          </ion-card>
        </ion-col>

        <ion-col size="4">
          <ion-card class="stat-card">
            <ion-card-content>
              <h2>{{ getCompletedCount() }}</h2>
              <p>Completed</p>
            </ion-card-content>
          </ion-card>
        </ion-col>

        <ion-col size="4">
          <ion-card class="stat-card">
            <ion-card-content>
              <h2>{{ getAverageProgress() }}%</h2>
              <p>Average</p>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>

    <!-- Loading -->
    <div *ngIf="isLoadingProgress" class="ion-text-center">
      <ion-spinner></ion-spinner>
      <p>Loading progress...</p>
    </div>

    <!-- Students -->
    <ion-list *ngIf="!isLoadingProgress && studentProgress.length > 0">
      <ion-item *ngFor="let progress of studentProgress">
        <ion-avatar slot="start">
          <ion-icon name="person-circle-outline" size="large"></ion-icon>
        </ion-avatar>

        <ion-label>
          <h3>Student {{ progress.studentId }}</h3>
          <p>Status: {{ getProgressStatus(progress.overallProgress) }}</p>
        </ion-label>

        <ion-progress-bar
          [value]="progress.overallProgress / 100"
          [color]="getProgressColor(progress.overallProgress)">
        </ion-progress-bar>
      </ion-item>
    </ion-list>

    <p *ngIf="!isLoadingProgress && studentProgress.length === 0"
      class="ion-text-center">
      No students enrolled yet.
    </p>

  </ng-container>

</ion-content>
