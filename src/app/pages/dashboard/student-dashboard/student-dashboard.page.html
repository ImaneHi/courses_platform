<ion-item *ngFor="let course of enrolledCourses">

  <ion-label>
    <h2>{{ course.title }}</h2>
    <p>{{ course.category }}</p>

    <!-- ✅ capture sécurisée -->
    <ng-container *ngIf="course.id as cid">

      <div *ngIf="getProgressForCourse(cid)" class="progress-info">
        <ion-progress-bar
          [value]="getProgressForCourseSafe(cid).overallProgress / 100"
          [color]="getProgressColor(getProgressForCourseSafe(cid).overallProgress)">
        </ion-progress-bar>

        <p>
          Progress: {{ getProgressForCourseSafe(cid).overallProgress }}%
        </p>
      </div>

      <ion-button (click)="viewCourse(cid)" fill="clear">
        <ion-icon name="book-outline"></ion-icon>
      </ion-button>

      <ng-container *ngFor="let lesson of (course.lessons || [])">

        <ng-container *ngIf="lesson.quiz?.id as qid">

          <ion-button
            *ngIf="canTakeQuiz(cid, qid)"
            (click)="takeQuiz(cid, qid)"
            color="primary"
            size="small">
            Quiz: {{ lesson.title }}
          </ion-button>

          <ion-button
            *ngIf="isQuizCompleted(cid, qid)"
            color="success"
            size="small"
            disabled>
            Quiz: {{ lesson.title }} ({{ getQuizScore(cid, qid) }}%)
          </ion-button>

        </ng-container>

      </ng-container>

    </ng-container>
  </ion-label>

</ion-item>
